@page "/dashboard"
@using Duckify.Data
@using Duckify.Services
@using Microsoft.AspNetCore.Http.Extensions
@using Microsoft.Extensions.Configuration

@inject AuthenticationStateProvider Auth
@inject NavigationManager NavigationManager
@inject SpotifyService Spotify


@if (!Auth.GetAuthenticationStateAsync().Result.User.IsInRole("Admin")) {
    <h3 class="text-danger">You don't have the authorization to access this page</h3>
    <h5>Nice attempt tho</h5>
    return;
}

<button type="button" disabled="@IsDisabled" class="btn btn-success" @onclick="RedirectToSpotify">Log in with Spotify</button>

<span class="text-danger" hidden="@(!IsDisabled)"> Spotify API client ID and Secret is not configured</span>

@code{

    bool IsDisabled { get; set; }

    protected override void OnInitialized() {
        base.OnInitialized();
        IsDisabled = !Spotify.HasClientIds;
    }
    private void RedirectToSpotify() {
        NavigationManager.NavigateTo(Spotify.GetSpotifyLoginRedirectUri());
    }

}